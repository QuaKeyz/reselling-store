<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Store</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
    h1 { margin: 0 0 14px; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
      gap: 14px;
    }
    .card {
      border: 1px solid #e6e6e6;
      border-radius: 10px;
      padding: 10px;
      cursor: pointer;
      background: #fff;
    }
    .card img {
      width: 100%;
      height: 170px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #f0f0f0;
    }
    .name { margin: 8px 0 4px; font-size: 14px; }
    .price { margin: 0; font-weight: bold; }
    .muted { color: #777; font-size: 13px; }
  </style>
</head>
<body>
  <h1>Shop</h1>
  <p class="muted" id="status">Loading productsâ€¦</p>
  <div class="grid" id="grid"></div>

  <script>
    function dollars(cents) {
      const n = Number(cents);
      if (!Number.isFinite(n)) return "";
      return "$" + (n / 100).toFixed(2);
    }

    async function load() {
      const status = document.getElementById("status");
      const grid = document.getElementById("grid");

      try {
        const res = await fetch("/api/products");
        const products = await res.json();

        if (!Array.isArray(products) || products.length === 0) {
          status.textContent = "No products available.";
          return;
        }

        status.textContent = "";
        grid.innerHTML = "";

        products.forEach((p) => {
          const card = document.createElement("div");
          card.className = "card";

          // click into product detail page
          card.addEventListener("click", () => {
            window.location.href = `/product.html?id=${encodeURIComponent(p.id)}`;
          });

          const img = document.createElement("img");
          img.src = p.imageUrl || "";
          img.alt = p.name || "";

          const name = document.createElement("div");
          name.className = "name";
          name.textContent = p.name || p.id;

          const price = document.createElement("p");
          price.className = "price";
          price.textContent = dollars(p.priceCents);

          card.appendChild(img);
          card.appendChild(name);
          card.appendChild(price);
          grid.appendChild(card);
        });
      } catch (e) {
        status.textContent = "Failed to load products.";
        console.error(e);
      }
    }

    load();
  </script>
</body>
</html>
